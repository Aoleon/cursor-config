# R√®gles Cursor - Saxium

**R√©f√©rence:** [Cursor Rules Documentation](https://docs.cursor.com/context/rules)  
**Version:** 3.0.0  
**Derni√®re mise √† jour:** 2025-01-29

Ce fichier garantit que les r√®gles du projet sont automatiquement charg√©es dans tous les nouveaux chats Cursor.

## üìã R√®gles Essentielles

Les r√®gles compl√®tes sont organis√©es dans `.cursor/rules/` et sont automatiquement charg√©es selon leur priorit√©. Ce fichier garantit que les r√®gles fondamentales sont toujours appliqu√©es.

### Contexte du Projet

Saxium est une application full-stack de gestion de projets pour **JLM Menuiserie** (BTP/Menuiserie fran√ßaise). Stack: React 19 + TypeScript, Express 5, PostgreSQL (Drizzle ORM), IA multi-mod√®les (Claude Sonnet 4 + GPT-5).

**Architecture:** Migration progressive vers modules (`server/modules/*`), services m√©tier (`server/services/*`), types partag√©s (`shared/schema.ts`)

### Philosophie de Qualit√©

**Priorit√©s (dans l'ordre):**
1. **Robustesse** - R√©sistance aux erreurs, gestion d'erreurs compl√®te
2. **Maintenabilit√©** - Code clair, document√©, test√©, √©volutif
3. **Performance** - Optimisation continue, latence minimale

**R√©f√©rence:** `@.cursor/rules/quality-principles.md` - Principes de qualit√© complets

## üéØ Priorit√©s des R√®gles

Les r√®gles sont organis√©es en 3 niveaux de priorit√© pour optimiser le chargement :

### P0 - R√®gles Critiques (Toujours Appliqu√©es)

**Chargement:** Automatique dans tous les contextes

- `@.cursor/rules/core.md` - R√®gles fondamentales du projet
- `@.cursor/rules/quality-principles.md` - Philosophie de qualit√©
- `@.cursor/rules/code-quality.md` - Standards stricts de qualit√© code

### P1 - R√®gles Importantes (Selon Contexte)

**Chargement:** Automatique selon le type de modification

- `@.cursor/rules/backend.md` - Si modification dans `server/**/*.ts`
- `@.cursor/rules/frontend.md` - Si modification dans `client/src/**/*.tsx`
- `@.cursor/rules/database.md` - Si modification sch√©ma DB
- `@.cursor/rules/ai-services.md` - Si modification services IA
- `@.cursor/rules/testing.md` - Si modification tests

### P2 - R√®gles d'Optimisation (Optionnelles)

**Chargement:** Sur demande ou pour t√¢ches complexes

- `@.cursor/rules/pre-task-evaluation.md` - √âvaluation pr√©alable compl√®te
- `@.cursor/rules/pre-task-quick.md` - √âvaluation pr√©alable rapide
- `@.cursor/rules/agent-optimization.md` - Strat√©gies d'optimisation
- `@.cursor/rules/autonomous-workflows.md` - Workflows autonomes

**R√©f√©rence:** `@.cursor/rules/priority.md` - Priorit√©s d√©taill√©es et matrice de chargement

## ‚úÖ Checklist Rapide des R√®gles Essentielles

### Avant Toute Modification

- [ ] Lire `activeContext.md` pour conna√Ætre l'√©tat actuel
- [ ] Lire `projectbrief.md` pour comprendre le p√©rim√®tre
- [ ] Lire `systemPatterns.md` pour comprendre l'architecture
- [ ] Consulter `@.cursor/rules/quick-start.md` pour checklist rapide
- [ ] √âvaluer approche avec `@.cursor/rules/pre-task-quick.md` (si complexe)

### R√®gles Fondamentales

**TOUJOURS:**
- ‚úÖ Utiliser `asyncHandler` pour toutes les routes (pas de try-catch)
- ‚úÖ Utiliser `logger` de `server/utils/logger.ts` (jamais `console.log`)
- ‚úÖ Utiliser erreurs typ√©es (`ValidationError`, `NotFoundError`, etc.)
- ‚úÖ Valider avec Zod avant traitement
- ‚úÖ Utiliser types depuis `@shared/schema.ts`
- ‚úÖ Superviser, prioriser, piloter et revoir le code avec crit√®res d'architecte (IMP√âRATIF)
- ‚úÖ Valider alignement business/m√©tier avec cahier des charges, audit et objectifs business (IMP√âRATIF)
- ‚úÖ V√©rifier que les d√©veloppements r√©solvent les probl√©matiques de base identifi√©es (IMP√âRATIF)
- ‚úÖ Superviser migration modulaire et d√©tecter r√©gressions (IMP√âRATIF si migration/refactoring)
- ‚úÖ Identifier et √©liminer dette technique (services dupliqu√©s, fichiers monolithiques) (IMP√âRATIF si consolidation/dette technique)
- ‚úÖ R√©duire radicalement les erreurs avec approche hard coding (IMP√âRATIF si t√¢che complexe n√©cessitant hard coding)
- ‚úÖ Automatiser t√¢ches tr√®s complexes avec approche cr√©ative innovante (IMP√âRATIF si t√¢che complexe n√©cessitant automatisation)
- ‚úÖ √âvaluer performances apr√®s chaque t√¢che (IMP√âRATIF)
- ‚úÖ Prioriser intelligemment les t√¢ches selon impact, urgence, dette technique (IMP√âRATIF)
- ‚úÖ V√©rifier l'√©tat de tous les todos avant de s'arr√™ter (IMP√âRATIF)
- ‚úÖ Continuer jusqu'√† completion de tous les todos en cours (IMP√âRATIF)
- ‚úÖ It√©rer automatiquement jusqu'√† ce que tous les probl√®mes soient r√©solus (IMP√âRATIF)
- ‚úÖ Valider compl√®tement avant de s'arr√™ter (IMP√âRATIF)
- ‚úÖ V√©rifier exhaustivement avant TOUT arr√™t (todos, erreurs, tests, fonctionnalit√©s, validation) (IMP√âRATIF)
- ‚úÖ Forcer continuation si v√©rifications √©chouent (IMP√âRATIF)
- ‚úÖ D√©tecter signes d'arr√™t pr√©matur√© et forcer continuation (IMP√âRATIF)
- ‚úÖ Maintenir keep-alive pendant runs longs (checkpoints r√©guliers) (IMP√âRATIF)
- ‚úÖ Optimiser contexte r√©guli√®rement pour √©viter saturation (IMP√âRATIF)
- ‚úÖ Sauvegarder √©tat r√©guli√®rement (toutes les 5-10 minutes) (IMP√âRATIF)
- ‚úÖ D√©tecter stagnation et forcer progression (IMP√âRATIF)
- ‚úÖ Continuer jusqu'√† completion compl√®te m√™me pour runs tr√®s longs (IMP√âRATIF)
- ‚úÖ Apprendre des patterns d'erreurs pr√©c√©dents pour optimiser it√©rations (IMP√âRATIF)
- ‚úÖ Prioriser corrections selon apprentissages (fr√©quence, impact, succ√®s) (IMP√âRATIF)
- ‚úÖ Adapter strat√©gies selon apprentissages (IMP√âRATIF)
- ‚úÖ Coordonner r√¥les avec apprentissage collectif (IMP√âRATIF)
- ‚úÖ Valider avec validation crois√©e am√©lior√©e entre r√¥les (IMP√âRATIF)
- ‚úÖ Am√©liorer continuellement les strat√©gies d'it√©ration (IMP√âRATIF)
- ‚úÖ Adapter it√©rations selon complexit√© de la t√¢che (IMP√âRATIF)
- ‚úÖ R√©utiliser solutions efficaces pour erreurs similaires (IMP√âRATIF)
- ‚úÖ Rechercher code similaire avant cr√©ation/modification (IMP√âRATIF)
- ‚úÖ R√©utiliser apprentissages et solutions efficaces (IMP√âRATIF)
- ‚úÖ Valider pr√©ventivement avant modification (IMP√âRATIF)
- ‚úÖ D√©tecter et corriger automatiquement les probl√®mes de performance (IMP√âRATIF)
- ‚úÖ G√©rer intelligemment le contexte pour √©viter la saturation (IMP√âRATIF)
- ‚úÖ Consolider automatiquement les workflows r√©ussis (IMP√âRATIF)
- ‚úÖ G√©rer intelligemment les d√©pendances pour √©viter les r√©gressions (IMP√âRATIF)
- ‚úÖ S√©lectionner automatiquement le mod√®le IA le plus adapt√© √† la t√¢che (IMP√âRATIF)
- ‚úÖ Mettre en cache les recherches fr√©quentes pour r√©duire la latence (IMP√âRATIF)
- ‚úÖ Ex√©cuter plusieurs op√©rations en parall√®le si ind√©pendantes (IMP√âRATIF)
- ‚úÖ Traiter plusieurs t√¢ches similaires en lot pour optimiser l'efficacit√© (IMP√âRATIF)
- ‚úÖ R√©cup√©rer automatiquement apr√®s erreurs (IMP√âRATIF)
- ‚úÖ D√©tecter automatiquement les conflits potentiels avant modification (IMP√âRATIF)
- ‚úÖ D√©tecter automatiquement les bugs potentiels avant qu'ils ne se produisent (IMP√âRATIF)
- ‚úÖ **D√âTECTER AUTOMATIQUEMENT les mentions de "prochaines √©tapes", "√©tapes suivantes", "next steps", "t√¢ches restantes", "il reste", "il faudra", "ensuite", "plus tard" dans la r√©ponse (IMP√âRATIF)**
- ‚úÖ **PLANIFIER AUTOMATIQUEMENT les prochaines √©tapes identifi√©es d√®s qu'elles sont mentionn√©es (IMP√âRATIF)**
- ‚úÖ **EX√âCUTER IMM√âDIATEMENT les prochaines √©tapes planifi√©es sans s'arr√™ter (IMP√âRATIF)**
- ‚úÖ **NE JAMAIS s'arr√™ter si des prochaines √©tapes sont mentionn√©es dans la r√©ponse (IMP√âRATIF)**

**NE JAMAIS:**
- ‚ùå Utiliser `console.log`/`error` dans le code serveur
- ‚ùå Cr√©er des `try-catch` dans les routes
- ‚ùå Lancer des erreurs g√©n√©riques `throw new Error()`
- ‚ùå Ex√©cuter SQL brut (toujours via Drizzle ORM)
- ‚ùå Cr√©er nouvelles instances de services IA (utiliser getters)
- ‚ùå Ignorer supervision architecturale pour t√¢ches complexes (IMP√âRATIF)
- ‚ùå Ignorer validation business/m√©tier pour t√¢ches complexes (IMP√âRATIF)
- ‚ùå Ignorer supervision migration pour t√¢ches de migration/refactoring (IMP√âRATIF)
- ‚ùå Ignorer gestion dette technique pour t√¢ches de consolidation (IMP√âRATIF)
- ‚ùå Ignorer hard coding pour t√¢ches complexes n√©cessitant r√©duction radicale erreurs (IMP√âRATIF)
- ‚ùå Ignorer automatisation cr√©ative pour t√¢ches tr√®s complexes (IMP√âRATIF)
- ‚ùå D√©velopper fonctionnalit√©s hors p√©rim√®tre ou contraires aux attentes client (IMP√âRATIF)
- ‚ùå D√©velopper fonctionnalit√©s qui ne r√©solvent pas les probl√©matiques de base (IMP√âRATIF)
- ‚ùå Ne pas prioriser intelligemment les t√¢ches (IMP√âRATIF)
- ‚ùå Ne pas revoir le code avec crit√®res d'architecte (IMP√âRATIF)
- ‚ùå S'arr√™ter tant qu'il reste des todos `in_progress` ou `pending` (IMP√âRATIF)
- ‚ùå S'arr√™ter s'il reste des erreurs TypeScript ou des tests qui √©chouent (IMP√âRATIF)
- ‚ùå S'arr√™ter sans valider compl√®tement (IMP√âRATIF)
- ‚ùå Cr√©er du code sans rechercher code similaire (IMP√âRATIF)
- ‚ùå Ignorer la m√©moire des apprentissages (IMP√âRATIF)
- ‚ùå Modifier sans validation pr√©ventive (IMP√âRATIF)
- ‚ùå Ignorer les probl√®mes de performance potentiels (IMP√âRATIF)
- ‚ùå Saturer le contexte avec trop de fichiers (IMP√âRATIF)
- ‚ùå Ignorer les workflows r√©ussis √† consolider (IMP√âRATIF)
- ‚ùå Modifier sans analyser les d√©pendances (IMP√âRATIF)
- ‚ùå Utiliser un mod√®le IA sans analyser le type de t√¢che (IMP√âRATIF)
- ‚ùå Refaire les m√™mes recherches sans utiliser le cache (IMP√âRATIF)
- ‚ùå Ex√©cuter s√©quentiellement des op√©rations ind√©pendantes (IMP√âRATIF)
- ‚ùå Traiter individuellement des t√¢ches similaires multiples (IMP√âRATIF)
- ‚ùå Ignorer les erreurs sans tentative de r√©cup√©ration (IMP√âRATIF)
- ‚ùå Modifier sans d√©tecter conflits potentiels (IMP√âRATIF)
- ‚ùå Ignorer les bugs potentiels d√©tect√©s (IMP√âRATIF)
- ‚ùå **S'arr√™ter en annon√ßant des "prochaines √©tapes" ou "√©tapes suivantes" sans les ex√©cuter (IMP√âRATIF)**
- ‚ùå **Mentionner des t√¢ches restantes sans les planifier et ex√©cuter imm√©diatement (IMP√âRATIF)**
- ‚ùå **Mentionner qu'on va faire quelque chose "ensuite" ou "plus tard" sans l'ex√©cuter imm√©diatement (IMP√âRATIF)**
- ‚ùå **S'arr√™ter si la r√©ponse contient des phrases comme "prochaines √©tapes", "il reste", "il faudra", "dans un second temps" (IMP√âRATIF)**

## ‚ö†Ô∏è R√àGLE ANTI-INTERRUPTION : PROCHAINES √âTAPES (CRITIQUE)

**PROBL√àME IDENTIFI√â:** L'agent s'arr√™te encore alors qu'il mentionne des "prochaines √©tapes" dans sa r√©ponse.

**SOLUTION STRICTE:**

### Workflow Obligatoire Avant TOUT Arr√™t

**√âTAPE 1 - D√©tection Automatique (OBLIGATOIRE):**
Avant de s'arr√™ter, l'agent DOIT analyser sa propre r√©ponse pour d√©tecter :
- Phrases contenant "prochaines √©tapes", "√©tapes suivantes", "next steps"
- Phrases contenant "t√¢ches restantes", "il reste", "il faudra", "actions √† faire"
- Phrases contenant "ensuite", "plus tard", "dans un second temps", "then", "later"

**√âTAPE 2 - Planification Automatique (OBLIGATOIRE):**
Si des mentions sont d√©tect√©es, l'agent DOIT :
- Identifier toutes les prochaines √©tapes mentionn√©es
- Cr√©er un plan d√©taill√© pour ces √©tapes
- Cr√©er des todos pour chaque √©tape identifi√©e

**√âTAPE 3 - Ex√©cution Imm√©diate (OBLIGATOIRE):**
L'agent DOIT :
- Ex√©cuter imm√©diatement les todos cr√©√©s
- Ne pas s'arr√™ter tant que toutes les √©tapes ne sont pas compl√©t√©es
- V√©rifier que toutes les √©tapes sont compl√©t√©es avant de s'arr√™ter

**R√àGLE ABSOLUE:**
**Si l'agent mentionne des "prochaines √©tapes" dans sa r√©ponse, il DOIT les planifier et les ex√©cuter imm√©diatement. Aucun arr√™t n'est autoris√© tant que ces √©tapes ne sont pas compl√©t√©es.**

**Pattern de D√©tection:**
```typescript
// Avant de s'arr√™ter, analyser la r√©ponse
const response = getLastResponse();
const nextStepsPhrases = [
  'prochaines √©tapes', '√©tapes suivantes', 'next steps',
  't√¢ches restantes', 'il reste', 'il faudra', 'actions √† faire',
  'ensuite', 'plus tard', 'dans un second temps', 'then', 'later'
];

const hasNextSteps = nextStepsPhrases.some(phrase => 
  response.toLowerCase().includes(phrase.toLowerCase())
);

if (hasNextSteps) {
  // FORCER planification et ex√©cution
  await planAndExecuteNextSteps(response);
  // NE PAS s'arr√™ter
}
```

## üîó Documentation Compl√®te

### R√®gles D√©taill√©es

**P0 - Critiques:**
- `@.cursor/rules/core.md` - R√®gles fondamentales
- `@.cursor/rules/quality-principles.md` - Principes de qualit√©
- `@.cursor/rules/code-quality.md` - Standards qualit√© code

**P1 - Importantes:**
- `@.cursor/rules/backend.md` - Patterns backend
- `@.cursor/rules/frontend.md` - Patterns frontend
- `@.cursor/rules/database.md` - R√®gles base de donn√©es
- `@.cursor/rules/ai-services.md` - Services IA
- `@.cursor/rules/testing.md` - Patterns tests
- `@.cursor/rules/performance.md` - Optimisations performance
- `@.cursor/rules/senior-architect-oversight.md` - Supervision architecte s√©nior (IMP√âRATIF - supervision, priorisation, pilotage, code review)
- `@.cursor/rules/client-consultant-oversight.md` - Supervision consultant client (IMP√âRATIF - validation cahier des charges, audit, objectifs business, probl√©matiques de base)
- `@.cursor/rules/migration-refactoring-manager.md` - Gestionnaire migration/refactoring (IMP√âRATIF - supervision migration modulaire, d√©tection r√©gressions, validation coh√©rence)
- `@.cursor/rules/tech-debt-manager.md` - Gestionnaire dette technique (IMP√âRATIF - identification services dupliqu√©s, planification consolidation, r√©duction monolithiques)
- `@.cursor/rules/hard-coding-specialist.md` - Sp√©cialiste hard coding (IMP√âRATIF - r√©duction radicale erreurs, automatisation t√¢ches complexes, approche cr√©ative innovante)
- `@.cursor/rules/todo-completion.md` - Completion des todos (IMP√âRATIF - √©viter interruptions)
- `@.cursor/rules/iterative-perfection.md` - It√©ration automatique jusqu'√† perfection (IMP√âRATIF - √©viter arr√™t pr√©matur√©)
- `@.cursor/rules/persistent-execution.md` - Ex√©cution persistante (IMP√âRATIF - √©viter arr√™ts pr√©matur√©s, runs longs)
- `@.cursor/rules/advanced-iteration-and-role-coordination.md` - It√©rations avanc√©es et coordination des r√¥les (IMP√âRATIF - maximiser autonomie, dur√©e, qualit√©)
- `@.cursor/rules/similar-code-detection.md` - D√©tection proactive de code similaire (√©viter duplication)
- `@.cursor/rules/learning-memory.md` - M√©moire persistante des apprentissages (r√©utiliser solutions)
- `@.cursor/rules/preventive-validation.md` - Validation pr√©ventive (pr√©venir erreurs)
- `@.cursor/rules/auto-performance-detection.md` - D√©tection et correction automatique des probl√®mes de performance
- `@.cursor/rules/context-optimization.md` - Gestion intelligente du contexte (√©viter saturation)
- `@.cursor/rules/workflow-consolidation.md` - Consolidation automatique des workflows r√©ussis
- `@.cursor/rules/dependency-intelligence.md` - Intelligence des d√©pendances (√©viter r√©gressions)
- `@.cursor/rules/intelligent-model-selection.md` - S√©lection intelligente du mod√®le IA (optimiser performances/co√ªts)
- `@.cursor/rules/search-cache.md` - Cache intelligent des recherches (r√©duire latence)
- `@.cursor/rules/parallel-execution.md` - Ex√©cution parall√®le (am√©liorer performances)
- `@.cursor/rules/batch-processing.md` - Traitement par lots (optimiser efficacit√©)
- `@.cursor/rules/error-recovery.md` - R√©cup√©ration automatique apr√®s erreurs (am√©liorer robustesse)
- `@.cursor/rules/conflict-detection.md` - D√©tection proactive des conflits (√©viter probl√®mes)
- `@.cursor/rules/bug-prevention.md` - D√©tection proactive des bugs (am√©liorer qualit√©)

**P2 - Optimisation:**
- `@.cursor/rules/workflows.md` - Workflows courants
- `@.cursor/rules/agent-optimization.md` - Strat√©gies d'optimisation
- `@.cursor/rules/autonomous-workflows.md` - Workflows autonomes
- `@.cursor/rules/pre-task-evaluation.md` - √âvaluation pr√©alable compl√®te
- `@.cursor/rules/pre-task-quick.md` - √âvaluation pr√©alable rapide

### Guides et R√©f√©rences

- `@.cursor/rules/quick-start.md` - Guide de d√©marrage rapide
- `@.cursor/rules/priority.md` - Priorit√©s et matrice de chargement
- `@.cursor/rules/anti-patterns.md` - Anti-patterns consolid√©s
- `@.cursor/rules/examples.md` - Exemples concrets par type de t√¢che
- `@.cursor/rules/context-usage.md` - Utilisation optimale du contexte
- `@.cursor/rules/context-detection.md` - D√©tection automatique du contexte
- `@.cursor/rules/load-strategy.md` - Strat√©gie de chargement optimis√©e
- `@AGENTS.md` - Index simplifi√© des r√®gles

### Fichiers de Contexte

- `@projectbrief.md` - Objectifs et p√©rim√®tre
- `@activeContext.md` - Focus actuel
- `@systemPatterns.md` - Patterns architecturaux
- `@productContext.md` - Exp√©rience utilisateur
- `@techContext.md` - Stack technique
- `@progress.md` - √âtat du projet

---

**Note:** Les r√®gles d√©taill√©es sont dans `.cursor/rules/` et sont automatiquement charg√©es par Cursor selon le contexte et la priorit√©. Consultez `@.cursor/rules/priority.md` pour comprendre le syst√®me de priorisation.

**Version:** 3.0.0  
**Derni√®re mise √† jour:** 2025-01-29
